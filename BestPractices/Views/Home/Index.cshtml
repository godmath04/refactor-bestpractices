@model HomeViewModel;

@{
    ViewData["Title"] = "Vehicle Management - Home Page";
}

<div class="container mt-4">
    <div class="text-center mb-4">
        <h1 class="display-4">Vehicle Management System</h1>
        <p class="lead">Manage your vehicle fleet with ease</p>
    </div>

    @* Success Message *@
    @if (!string.IsNullOrEmpty(ViewBag.SuccessMessage))
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <strong><i class="bi bi-check-circle-fill"></i> Success!</strong> @ViewBag.SuccessMessage
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @* Error Message *@
    @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong><i class="bi bi-exclamation-triangle-fill"></i> Error!</strong> @ViewBag.ErrorMessage
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @* Vehicle Count Summary *@
    <div class="row mb-3">
        <div class="col-md-12">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title">Fleet Summary</h5>
                    <p class="card-text">
                        <strong>Total Vehicles:</strong> @Model.Vehicles.Count
                        @if (Model.Vehicles.Count > 0)
                        {
                            var runningCount = Model.Vehicles.Count(v => v.IsEngineOn());
                            <span class="ml-3">
                                <strong>Running:</strong> <span class="badge badge-success">@runningCount</span>
                                <strong>Stopped:</strong> <span class="badge badge-secondary">@(Model.Vehicles.Count - runningCount)</span>
                            </span>
                        }
                    </p>
                </div>
            </div>
        </div>
    </div>

    @* Add Vehicle Buttons *@
    <div class="mb-3">
        <a href="/Home/AddMustang" class="btn btn-danger btn-lg">
            <i class="bi bi-plus-circle"></i> Add Ford Mustang
        </a>
        <a href="/Home/AddExplorer" class="btn btn-dark btn-lg">
            <i class="bi bi-plus-circle"></i> Add Ford Explorer
        </a>
    </div>

    @* Vehicles Table *@
    @if (Model.Vehicles.Count == 0)
    {
        <div class="alert alert-info" role="alert">
            <h4 class="alert-heading">No vehicles in your fleet!</h4>
            <p>Click one of the buttons above to add your first vehicle.</p>
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th style="width: 120px;">ID</th>
                        <th>Type</th>
                        <th>Brand</th>
                        <th>Model</th>
                        <th>Year</th>
                        <th>Color</th>
                        <th>Tires</th>
                        <th>Fuel Level</th>
                        <th style="width: 120px;">Engine Status</th>
                        <th style="width: 300px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var vehicle in Model.Vehicles)
                    {
                        var fuelPercentage = (vehicle.Gas / vehicle.FuelLimit) * 100;
                        var fuelClass = fuelPercentage > 50 ? "success" : (fuelPercentage > 20 ? "warning" : "danger");

                        <tr>
                            <td>
                                <small class="text-muted" title="@vehicle.Id">
                                    @vehicle.Id.ToString().Substring(0, 8)...
                                </small>
                            </td>
                            <td>
                                <span class="badge badge-info">@vehicle.GetType().Name</span>
                            </td>
                            <td>@vehicle.Brand</td>
                            <td>@vehicle.Model</td>
                            <td class="text-center">@vehicle.Year</td>
                            <td>
                                <span class="badge badge-secondary">@vehicle.Color</span>
                            </td>
                            <td class="text-center">@vehicle.Tires</td>
                            <td>
                                <div class="progress" style="height: 25px;" title="@vehicle.Gas.ToString("N1") / @vehicle.FuelLimit.ToString("N1") gallons">
                                    <div class="progress-bar bg-@fuelClass" role="progressbar"
                                         style="width: @fuelPercentage.ToString("N0")%"
                                         aria-valuenow="@vehicle.Gas" aria-valuemin="0" aria-valuemax="@vehicle.FuelLimit">
                                        @vehicle.Gas.ToString("N1") / @vehicle.FuelLimit.ToString("N1")
                                    </div>
                                </div>
                            </td>
                            <td class="text-center">
                                @if (vehicle.IsEngineOn())
                                {
                                    <span class="badge badge-success">
                                        <i class="bi bi-power"></i> Running
                                    </span>
                                }
                                else
                                {
                                    <span class="badge badge-secondary">
                                        <i class="bi bi-stop-circle"></i> Stopped
                                    </span>
                                }
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    @if (vehicle.IsEngineOn())
                                    {
                                        <a href="/Home/StopEngine?id=@vehicle.Id"
                                           class="btn btn-warning"
                                           title="Stop Engine">
                                            <i class="bi bi-stop-fill"></i> Stop
                                        </a>
                                    }
                                    else
                                    {
                                        <a href="/Home/StartEngine?id=@vehicle.Id"
                                           class="btn btn-success"
                                           title="Start Engine">
                                            <i class="bi bi-play-fill"></i> Start
                                        </a>
                                    }

                                    <a href="/Home/AddGas?id=@vehicle.Id"
                                       class="btn btn-primary"
                                       title="Add Fuel"
                                       @(vehicle.Gas >= vehicle.FuelLimit ? "disabled" : "")>
                                        <i class="bi bi-droplet-fill"></i> Add Fuel
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@* Add Bootstrap Icons CSS if not already included *@
@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
}
